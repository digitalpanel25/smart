# 🧠 Architecture du Système IA (Analyse + Alertes Temps Réel + LLM)

--------------------------------------------------------------------------------
                                     UTILISATEUR
--------------------------------------------------------------------------------
                                           |
                                           v
                                ┌───────────────────┐
                                │  LLM Planner &     │
                                │  Intent Detection  │
                                └───────────────────┘
                                           |
--------------------------------------------------------------------------------
             LLM BRAIN (REASONING + SQL/PANDAS GENERATION + AUTO-CORRECTION)
--------------------------------------------------------------------------------
                                           |
                         ┌────────────────────────────────────────┐
                         │               RAG Layer                │
                         │  Vector DB (schema, docs, samples)    │
                         └────────────────────────────────────────┘
                                           |
                   ┌─────────────────────────────────────────────────────────┐
                   │                 SQL / Pandas Generator                  │
                   └─────────────────────────────────────────────────────────┘
                                           |
                   ┌─────────────────────────────────────────────────────────┐
                   │          Validator & Sandbox (SQL + Python)             │
                   └─────────────────────────────────────────────────────────┘
                                           |
                   ┌─────────────────────────────────────────────────────────┐
                   │      Auto-Correction Loop (self-repair)                 │
                   └─────────────────────────────────────────────────────────┘
                                           |
--------------------------------------------------------------------------------
                               DATA ANALYSIS & EXECUTION
--------------------------------------------------------------------------------
                                           |
       ┌──────────────────────────────────────────────┬───────────────────────────────────────────────┐
       v                                              v                                               v
┌──────────────────────┐                  ┌──────────────────────┐                       ┌─────────────────────────┐
│  OLAP Database       │                  │  Python/Pandas Engine│                       │  Anomaly Detection      │
│  (ClickHouse/Snow)   │                  │  (Sandbox Secure)    │                       │  (Prophet + Stats + LLM)│
└──────────────────────┘                  └──────────────────────┘                       └─────────────────────────┘
       |                                              |                                               |
       |                                              |                                               |
       └──────────────────────────────┬───────────────┴──────────────────────────────┬────────────────┘
                                      v                                               v
                              ┌─────────────────┐                          ┌──────────────────────────┐
                              │ KPI Results     │                          │ Alerts Engine            │
                              │ (tables, json)  │                          │ (Rules + Thresholds)     │
                              └─────────────────┘                          └──────────────────────────┘
                                                                                     |
                                                                                     v
--------------------------------------------------------------------------------
                                  REAL-TIME ALERTING LAYER
--------------------------------------------------------------------------------
                                                                                     |
          ┌──────────────────────────┬─────────────────────────┬───────────────────────────┐
          v                          v                         v                           v
   ┌──────────────┐          ┌──────────────┐          ┌────────────────┐        ┌──────────────────┐
   │ SMS Gateway  │          │ Email Engine │          │ Slack/WhatsApp │        │ Voice TTS + Calls │
   └──────────────┘          └──────────────┘          └────────────────┘        └──────────────────┘

--------------------------------------------------------------------------------
                                    DATA INFRA LAYER
--------------------------------------------------------------------------------
          ┌──────────────────────────────┬──────────────────────────────┬──────────────────────────────┐
          v                              v                              v
┌──────────────────────┐     ┌──────────────────────────┐      ┌───────────────────────────┐
│  Data Sources        │     │   CDC / Streaming Layer   │      │    ETL / Processing       │
│ (DB, API, logs, CSV) │ --> │ (Debezium → Kafka topics) │ -->  │ (Spark, Flink, Dataflow)  │
└──────────────────────┘     └──────────────────────────┘      └───────────────────────────┘
                                                                      |
                                                                      v
                                                          ┌──────────────────────┐
                                                          │   Data Lake (S3)     │
                                                          │   Parquet / ORC      │
                                                          └──────────────────────┘

--------------------------------------------------------------------------------
                                    MONITORING & LEARNING
--------------------------------------------------------------------------------
       ┌──────────────────────────┬────────────────────────────────────┬─────────────────────────────┐
       v                          v                                    v
┌──────────────┐       ┌───────────────────────┐            ┌──────────────────────────┐
│ Logging (ELK)│       │ Metrics (Prometheus)  │            │  Learning Loop (LoRA/RAG)│
└──────────────┘       └───────────────────────┘            └──────────────────────────┘

--------------------------------------------------------------------------------
