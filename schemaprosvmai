# SmartVBAI - Plateforme IA Complète : Analyse + Alertes Temps Réel + LLM

## Architecture

```mermaid
graph TB
    subgraph "Frontend/API Gateway"
        API[API Gateway]
    end
    
    subgraph "Orchestration Layer"
        PLANNER[LLM Planner Service]
        TEMPORAL[Temporal Workflows]
    end
    
    subgraph "Intelligence Layer"
        RAG[RAG Service]
        GENERATOR[Code Generator]
        VALIDATOR[Validator/Sandbox]
        REPAIR[Auto-Correction Loop]
    end
    
    subgraph "Execution Layer"
        CLICKHOUSE[ClickHouse OLAP]
        PANDAS[Pandas Engine]
        WORKER[Execution Workers]
    end
    
    subgraph "Analytics & Alerts"
        ANOMALY[Anomaly Detection]
        ALERTS[Alerts Engine]
    end
    
    subgraph "Data Infrastructure"
        KAFKA[Kafka/Redpanda]
        DEBEZIUM[Debezium CDC]
        S3[S3/MinIO]
        MILVUS[Milvus Vector DB]
    end
    
    subgraph "Monitoring"
        PROM[Prometheus]
        GRAFANA[Grafana]
        ELK[ELK Stack]
    end
    
    API --> PLANNER
    PLANNER --> TEMPORAL
    TEMPORAL --> RAG
    TEMPORAL --> GENERATOR
    GENERATOR --> VALIDATOR
    VALIDATOR --> WORKER
    WORKER --> CLICKHOUSE
    WORKER --> PANDAS
    WORKER --> ANOMALY
    ANOMALY --> ALERTS
    VALIDATOR --> REPAIR
    REPAIR --> GENERATOR
    DEBEZIUM --> KAFKA
    KAFKA --> S3
    RAG --> MILVUS
    WORKER --> PROM
    ALERTS --> PROM
```

## Structure du Projet

```
smartvbai/
├── services/              # Microservices
│   ├── llm-planner/      # Service de planification LLM
│   ├── rag-service/      # Service RAG avec vector DB
│   ├── code-generator/   # Générateur SQL/Pandas
│   ├── validator/        # Validateur et sandbox
│   ├── execution-engine/ # Moteur d'exécution
│   ├── anomaly-service/  # Détection d'anomalies
│   ├── alerts-service/   # Système d'alertes
│   └── repair-service/   # Auto-correction
├── workflows/            # Temporal workflows
├── infra/                # Infrastructure as Code
│   ├── terraform/        # Terraform modules
│   └── helm/             # Helm charts
├── tests/                # Tests automatisés
│   ├── unit/
│   ├── integration/
│   └── e2e/
├── docs/                 # Documentation
│   ├── architecture.md
│   ├── runbooks/
│   └── api/
└── scripts/              # Scripts utilitaires
```

## Quick Start

### Prérequis

- Docker & Docker Compose
- Kubernetes (Minikube/Kind)
- Python 3.11+
- Terraform
- Helm 3

### Installation Locale

```bash
# 1. Cloner le repo
git clone <repo-url>
cd smartvbai

# 2. Démarrer l'infrastructure locale
cd infra/docker-compose
docker-compose up -d

# 3. Installer les dépendances Python
pip install -r requirements.txt

# 4. Lancer les services
make start-services

# 5. Exécuter les tests
make test
```

## Services

### LLM Planner Service

Génère des plans d'exécution à partir de requêtes utilisateur.

**API**: `POST /v1/plan`

### RAG Service

Recherche sémantique dans la documentation et schémas.

**API**: `POST /v1/rag/search`

### Code Generator

Génère du code SQL/Pandas optimisé.

**API**: `POST /v1/generate`

### Validator & Sandbox

Valide et exécute le code de manière sécurisée.

**API**: `POST /v1/validate`, `POST /v1/execute`

### Anomaly Detection

Détecte les anomalies dans les KPIs.

**API**: `POST /v1/anomaly/detect`

### Alerts Service

Gère les règles d'alerte et les dispatchers.

**API**: `POST /v1/alerts/create`, `GET /v1/alerts/history`

## Tests

```bash
# Tests unitaires
pytest tests/unit/

# Tests d'intégration
pytest tests/integration/

# Tests end-to-end
pytest tests/e2e/
```

## Déploiement

```bash
# Staging
terraform -chdir=infra/terraform apply -var=environment=staging

# Production
terraform -chdir=infra/terraform apply -var=environment=production
```

## Documentation

- [Architecture détaillée](docs/architecture.md)
- [Guide d'exploitation](docs/runbooks/operations.md)
- [API Reference](docs/api/README.md)

## License

MIT

