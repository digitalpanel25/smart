-------------------------------------------------------------
|                      VOICE INTERFACE                      |
-------------------------------------------------------------
|                                                           |
|   [Casque ESP32]                                          |
|     - Micro -> capture audio                              |
|     - Chip DSP (ou firmware) -> pré-traitement audio      |
|     - Envoi audio -> API Cloud STT (Speech-to-Text)       |
|     - Réception voix TTS -> lecture dans les écouteurs     |
|                                                           |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|                   SPEECH-TO-TEXT (CLOUD)                  |
-------------------------------------------------------------
|  - Transcription du message utilisateur                    |
|  - Normalisation du texte (ponctuation, langue, contexte)  |
|  - Passage au LLM pour routing et interprétation           |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|                 LLM – ORCHESTRATION AGENT                 |
-------------------------------------------------------------
|  Rôle :                                                   |
|   1. Comprendre l'intention de l'utilisateur               |
|   2. Déterminer l’action à effectuer                       |
|   3. Choisir le bon outil (SQL, Pandas, API, RAG, etc.)    |
|   4. Générer du code + valider + corriger                  |
|   5. Déclencher les alertes vocales si nécessaire          |
|                                                            |
|  Modules :                                                 |
|   - Prompt Routing                                         |
|   - Agent SQL                                              |
|   - Agent Pandas                                           |
|   - Agent RAG                                              |
|   - Agent Auto-Correct                                     |
|   - Agent Sécurité (vérifie droits et limites)             |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|                   KNOWLEDGE LAYER (RAG)                   |
-------------------------------------------------------------
|   Sources :                                                |
|     - Documentation interne                                |
|     - Schémas SQL                                          |
|     - Dictionnaire métier                                  |
|     - Logs historiques et incidents                        |
|     - Data catalog                                         |
|                                                            |
|   Fonctionnement :                                         |
|     - Embeddings                                           |
|     - Similarity search                                    |
|     - Contexte injecté dans le prompt                     |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|               SQL & PANDAS GENERATION (LLM)               |
-------------------------------------------------------------
|                                                            |
|   [SQL Generator]                                          |
|     - Construit la requête SQL                             |
|     - Vérifie la syntaxe                                   |
|     - Compare au schéma BDD via RAG                        |
|                                                            |
|   [SQL Validator]                                          |
|     - Exécute en mode "EXPLAIN"                            |
|     - Corrige automatiquement si erreur                     |
|                                                            |
|   [Pandas Generator]                                       |
|     - Génère dataframes, filtres, agrégations              |
|     - Mutations et statistiques                             |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|                 DATA ENGINE & STORAGE LAYER               |
-------------------------------------------------------------
|  - Data Warehouse / Lake                                   |
|  - Tables transactionnelles                                 |
|  - Historique                                             |
|  - Index pour requêtes rapides                             |
|  - Cache Redis / DuckDB                                    |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|               ANALYSE TEMPS RÉEL & ALERTING               |
-------------------------------------------------------------
|  Pipeline temps réel :                                     |
|    1. Ingestion (Kafka / MQTT / Webhooks)                  |
|    2. Feature Engineering automatique                      |
|    3. Détection d'anomalies (LLM + modèles Prophet)        |
|    4. Auto-validation                                      |
|    5. Déclenchement d’alertes                              |
|                                                            |
|  Types d’alertes :                                         |
|    - Voix (TTS vers casque ESP32)                          |
|    - SMS                                                   |
|    - Dashboard                                             |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|                      TEXT-TO-SPEECH                       |
-------------------------------------------------------------
|  - Génération voix (neural TTS)                            |
|  - Format audio compressé (Opus / WAV16)                   |
|  - Envoi au casque ESP32                                   |
-------------------------------------------------------------
                           |
                           v
-------------------------------------------------------------
|                     CASQUE VOCAL ESP32                    |
-------------------------------------------------------------
|  - Reçoit la voix synthétique                              |
|  - Lecture immédiate                                       |
|  - Interaction en boucle avec l’utilisateur                |
-------------------------------------------------------------
